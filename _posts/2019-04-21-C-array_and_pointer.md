---
layout: article
keys: 20190421
tags: C Array Pointer
title: C Array and Pointer
---

# 数组和指针的简单梳理

[1、数组](#1、数组)

[2、指针](#2、指针)

[3、字符数组](#3、字符数组)

[4、char* s;  与 char  a[];](#4、`char* s;`  与` char  a[];`)

[5、char **与char  *a[ ];](#5、`char **`与`char  *a[ ];`)



### 1、数组

数组是个变量。数组是多个**相同**元素的集合，在内存中分布在**地址相连**的单元中，所以可以通过其下标访问不同单元的元素（可以跳跃访问）。

举例子：

`a[10]`，其中元素可以是`int`，`char`，或者其他的类型如`*p`等等，但是必须都是相同的。

`a` `&a[0]`都可以代表数组a的首地址，其中`&a[0]`代表的既是数组a的首地址，也是`a[0]`元素的首地址。同理，`&a[i]`代表的是`a[i]`元素的首地址。

C语言中规定数组代表数组所在内存位置的首地址`a=&a[0]`。

|   0    |   1    |   2    |   3    |   4    |   5    |   6    |   7    |   8    |   9    |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
| `a[0]` | `a[1]` | `a[2]` | `a[3]` | `a[4]` | `a[5]` | `a[6]` | `a[7]` | `a[8]` | `a[9]` |



### 2、指针

指针是一种变量，只不过它的内存保存的是一个**地址**，这个地址标示着其他变量。我们可以通过这个指针来访问其他变量。

举例子：

`int *p`

`p`本身是一个变量，p是一个地址。`*`是取地址符。如果有`p=a`(a为上面的数组，代表之地址)或者`p=&a[0]`，那么就可以通过`*（p+i）`来访问`a[i]`元素，`p+i`代表数组a向后偏移的位置为i的首地址。



### 3、字符数组

字符数组就是一个存储着字符的数组。

举例子：

字符串常量：

> 定义：`char str[10];`十个元素，元素类型是字符；
>
> 初始化：`char str[10] = {"hello world"};`把hello world\0依次存入到数组str中；
>
> C语言中**<u>字符串常量</u>**的本质表示其实是一个地址。这就是为什么打印的时候使用的是`printf("%s", str)`。
>
> **C语言中操作字符串是通过它在内存中的存储单元的首地址进行的，这是字符串的终极本质。**

字符串变量：

> 定义：`char* sp = "China";`将一个字符串常量赋值给一个<u>**字符指针变量**</u>。原因："China"字符串在赋值时是将所在字符串的首地址赋值给sp，<u>也就是说sp是一个地址，里面指示的是字符串常量"China"的首地址</u>。



### 4、`char* s;`  与` char  a[];`

可以`s=a`，但是不能`a=s`。

a保存的是字符串的首地址；s也是保存字符串的首地址，故s=a；

a是一个常量类型，s是一个变量类型，常量类型不可以修改。

**字符指针**可以用<u>间接操作符*</u>取其内容，也可以用<u>数组的下标形式 [ ]</u>；**数组名**也可以用<u>*</u>操作，因为它本身表示一个地址。

举例子：

`char* s`与`char a[]`的本质区别：

> 1. 当定义`char a[10]`时，编译器会给数组分配10个单元，每个单元的数据类型为字符。`sizeof(a) = 10；`。
> 2. 定义`char *s` 时，这是个**指针变量**，只占4个字节，32位，用来保存一个地址。`sizeof(s) = 4`。
> 3. `printf("%p", s);`表示s的单元中保存的**地址**。
> 4. `printf("%p",&s);`表示是s变量本身所在的内存单元地址。

用一句话来概括，就是`char *s`只是一个保存字符串首地址的指针变量;`char a[]`是许多连续的内存单元，单元中的元素为`char`。之所以用`char *s`能达到`char a[]`的效果，还是字符串的本质，地址，即给你一个字符串地址，便可以随心所欲的操所他。但是，`char *s` 和`char a[]`的本质属性是不一样的。



### 5、`char **`与`char  *a[ ];`

**由于[]的优先级高于*，所以a先和[]结合，即是一个数组，数组中的元素才是char * ，char *是一个字符串变量，保存的是字符串的首地址。**

举例子：

```cpp
#include <iostream>

int main(int argc, const char * argv[]) {
    char* a[] = {"China", "French", "America", "German"};
    printf("%p %p %p %p\n", a[0], a[1], a[2], a[3]); //数组元素中保存的地址
    std::cout << a[0] << " " << a[1] << " " << a[2] << " " << a[3] << std::endl;
    printf("%p %p %p %p\n", &a[0], &a[1], &a[2], &a[3]);//数组元素单元本身（指针变量）的地址
    std::cout << &a[0] << " " << &a[1] << " " << &a[2] << " " << &a[3] << std::endl;
  
    char** s = a;
    std::cout << *s << " " << *(s+1) << " " << *(s+2) << " " << *(s+3) << std::endl;
    return 0;
}
```

上面程序运行结果：

```
0x100001edb 0x100001ee1 0x100001ee8 0x100001ef0 
China French America German
0x7ffeefbff4e0 0x7ffeefbff4e8 0x7ffeefbff4f0 0x7ffeefbff4f8
0x7ffeefbff4e0 0x7ffeefbff4e8 0x7ffeefbff4f0 0x7ffeefbff4f8
China French America German
// 64位机器 故位8个字节
0x7ffeefbff4e0 0x7ffeefbff4e8 0x7ffeefbff4f0 0x7ffeefbff4f8这四个是元素单元所在的地址，每个地址相差八个字节，这是由于每个元素是一个指针变量占八个字节
```

`注`：`sizeof(a)`的结果为16，在32位机器上，指针变量占四个字节，四个指针共16个字节。

```c
char *a [ ] = {"China","French","America","German"};
char **s =   a;
```

（1）为什么能把 `a`赋给`s`？

因为数组名`a`代表数组元素内存单元的首地址，即 `a = &a[0] = 0x7ffeefbff4e0`。而`0x7ffeefbff4e0`即`a[0]`中保存的又是`0x100001edb`,这个地址`0x100001edb`为字符串`"China"`的首地址。 即`*s = 0x100001edb = "China";`，`*s`是字符串`"China"`的首地址。

（2）看`**s`的使用方法。

注意看如何用`*s,*(s+1),*(s+2),*(s+3)`来访问`*a[]`的每一个元素。

（3）下面是等效的。

`printf("%s",*s);`

`printf("%s", a[0]);`

`printf("%s",*a);`

需要明白的是`%s`打印的时候，其实传入的是**字符串的首地址【地址】**。

（4）陷阱！

```c
char **s;
// 用里面两行会出现崩溃
*s = "Hello world!";
printf("%s", *s);
// 用下面三行不会崩溃，为啥？
s = (char**)malloc(sizeof(char**));
*s = "Hello world!";
printf("%s", *s);
```

原因必须`s`必须指向一个确切的地址，第一种用法s指向的地址随机，第二种分配了固定的内存，所以不会崩溃。

（5）二级指针简单用法。

```c
#include  <stdio.h>
void  buf(char** str)
{
    *str = "message"; // 这里的s是个二级指针，*str是直接指向为变量分配的内存地址的内容。
}
int main()
{
    char *s ;
    buf(&s)； // 这里为何可以取一级指针的地址即二级指针呢？因为变量会分配一个内存。
      // 这里的传入s就是str。理解一下
    printf("%s\n",s);
}
```

贴图：

![2019_04_21_array&pointer](https://raw.githubusercontent.com/Syuukensyou/syuukensyou.github.io/master/_posts_pic/2019_04_21_array&pointer.jpeg)                              



参考：

1、https://m.imooc.com/article/30475
